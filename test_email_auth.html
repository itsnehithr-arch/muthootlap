<!DOCTYPE html>
<html>
<head>
    <title>Email Auth Test</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Email Authentication Test</h1>
    <div id="log"></div>

    <script>
        const log = (message) => {
            document.getElementById('log').innerHTML += message + '<br>';
            console.log(message);
        };

        const firebaseConfig = {
            apiKey: "AIzaSyBdMu5Drpc21T8_GefLqFL_8idBoQSyr5w",
            authDomain: "prj-mg-coblr-nprd-lap-custjour.firebaseapp.com",
            projectId: "prj-mg-coblr-nprd-lap-custjour",
            storageBucket: "prj-mg-coblr-nprd-lap-custjour.firebasestorage.app",
            messagingSenderId: "350303734023",
            appId: "1:350303734023:web:7563f5da96d11d087e1da2"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            log('‚úÖ Firebase initialized');

            const auth = firebase.auth();
            
            // Try creating a test user with email/password
            auth.createUserWithEmailAndPassword('test@example.com', 'password123')
                .then((userCredential) => {
                    log('‚úÖ Email auth successful');
                    log('User ID: ' + userCredential.user.uid);
                    
                    // Test Firestore
                    return firebase.firestore().collection('test').doc('test').get();
                })
                .then((doc) => {
                    log('‚úÖ Firestore access successful');
                    log('üéâ Email auth + Firestore working!');
                })
                .catch((error) => {
                    if (error.code === 'auth/email-already-in-use') {
                        log('‚ÑπÔ∏è Test user exists, trying sign-in...');
                        return auth.signInWithEmailAndPassword('test@example.com', 'password123');
                    } else {
                        log('‚ùå Email auth error: ' + error.message);
                    }
                })
                .then((userCredential) => {
                    if (userCredential) {
                        log('‚úÖ Email sign-in successful');
                        return firebase.firestore().collection('test').doc('test').get();
                    }
                })
                .then((doc) => {
                    if (doc) {
                        log('‚úÖ Firestore access with email auth successful');
                    }
                })
                .catch((error) => {
                    log('‚ùå Final error: ' + error.message);
                });

        } catch (error) {
            log('‚ùå Init error: ' + error.message);
        }
    </script>
</body>
</html>
